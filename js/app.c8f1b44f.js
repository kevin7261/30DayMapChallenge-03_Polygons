(function(){"use strict";var e={8500:function(e,o,n){var t=n(5130),r=n(657),a=n(6768);const l={id:"app",class:"d-flex flex-column vh-100"},s={class:"d-flex flex-column overflow-hidden"};function i(e,o,n,t,r,i){const u=(0,a.g2)("router-view");return(0,a.uX)(),(0,a.CE)("div",l,[(0,a.Lk)("div",s,[(0,a.bF)(u)])])}var u=n(144),c={name:"App",components:{},setup(){const e=(0,u.KR)(!1),o=(0,u.KR)("載入中..."),n=(0,u.KR)(0),t=(0,u.KR)(!1),r=(0,u.KR)("");return{isLoading:e,loadingText:o,loadingProgress:n,showLoadingProgress:t,loadingSubText:r}}},p=n(1241);const d=(0,p.A)(c,[["render",i]]);var m=d,g=n(1387),f=n(4232);const y={id:"app",class:"d-flex flex-column vh-100"},v={class:"flex-grow-1 overflow-hidden position-relative"},b={class:"position-absolute",style:{top:"50%",left:"0",transform:"translateY(-50%)","z-index":"1000",padding:"1rem"}},h={class:"bg-dark bg-opacity-75 rounded-3 p-3"},C={class:""},w={class:"d-flex flex-column gap-1"},L=["onClick"];function T(e,o,n,t,r,l){const s=(0,a.g2)("MapTab");return(0,a.uX)(),(0,a.CE)("div",y,[(0,a.Lk)("div",v,[(0,a.bF)(s,{onMapReady:t.setMapInstance,"current-country":t.currentCountry},null,8,["onMapReady","current-country"]),(0,a.Lk)("div",b,[(0,a.Lk)("div",h,[(0,a.Lk)("div",C,[(0,a.Lk)("div",w,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(t.countries,(e=>((0,a.uX)(),(0,a.CE)("button",{key:e.layerId,class:(0,f.C4)(["btn border-0 my-country-btn my-font-sm-white px-4 py-3",[t.currentCountry===e.layerName?"active":""]]),onClick:o=>t.navigateToCountry(e.layerId)},(0,f.v_)(e.layerName),11,L)))),128))])])])])])])}n(8111),n(116);const x={id:"map-container",class:"h-100 w-100 position-relative bg-transparent z-0"},M=["id"];function k(e,o,n,t,r,l){return(0,a.uX)(),(0,a.CE)("div",x,[(0,a.Lk)("div",{id:t.mapContainerId,ref:"mapContainer",class:"h-100 w-100"},null,8,M),o[0]||(o[0]=(0,a.Lk)("div",{class:"position-absolute top-50 start-50 translate-middle",style:{"z-index":"1000","pointer-events":"none"}},[(0,a.Lk)("div",{class:"rounded-circle bg-white",style:{width:"4px",height:"4px"}})],-1))])}n(1701);var z=n(6886),R=n.n(z);n(4114);const I=(0,r.nY)("data",(()=>{const e=17,o=(0,u.KR)([{groupName:"世界國家",groupLayers:[{layerId:"Barcelona",layerName:"BARCELONA",center:[2.1744,41.4036],zoom:18},{layerId:"New York",layerName:"NEWYORK",center:[-73.991,40.760694],zoom:17}]}]),n=e=>{for(const n of o.value)for(const o of n.groupLayers)if(o.layerId===e)return o;return null},t=()=>{const e=[];for(const n of o.value)e.push(...n.groupLayers);return e},r=(0,u.KR)(null),l=e=>{r.value=e},s=(0,u.KR)(null),i=e=>{s.value=e},c=o=>{const t=n(o);if(!t)return void console.error("❌ 找不到國家圖層:",o);if(!s.value)return console.error("❌ 地圖實例未準備就緒，等待地圖初始化..."),void setTimeout((()=>{s.value?(console.log("🌍 地圖已準備就緒，重新嘗試移動"),c(o)):console.error("❌ 地圖實例仍未準備就緒")}),1e3);const[r,a]=t.center,l=[a,r],i=t.zoom||e;try{s.value.setView(l,i,{animate:!1}),console.log(`🌍 成功導航到國家: ${t.layerName}`)}catch(u){console.error("❌ 地圖導航失敗:",u)}};return{layers:o,findLayerById:n,getAllLayers:t,selectedFeature:r,setSelectedFeature:l,mapInstance:s,setMapInstance:i,navigateToCountry:c,visibleLayers:(0,a.EW)((()=>t()))}}),{persist:!0}),O=(0,r.nY)("define",{state:()=>({selectedBasemap:"google_satellite",mapView:{center:[41.4036,2.1744],zoom:18},basemaps:[{label:"Google Satellite",value:"google_satellite",url:"https://mt1.google.com/vt/lyrs=s&x={x}&y={y}&z={z}"}]}),actions:{setSelectedBasemap(e){this.selectedBasemap=e},setMapView(e,o){this.mapView.center=e,this.mapView.zoom=o}}});var E={name:"MapTab",props:{currentCountry:{type:String,default:"國家名稱"}},emits:["map-ready"],setup(e,{emit:o}){const n=I(),t=O(),r=(0,u.KR)(null);let l=null,s=null;const i=(0,u.KR)(!1),c=(0,u.KR)(`leaflet-map-${Math.random().toString(36).substr(2,9)}`),p=(0,a.EW)((()=>n.getAllLayers().length>0)),d=(0,a.EW)((()=>{if(!e.currentCountry)return console.log("❌ currentCountryInfo: 沒有當前國家"),null;const o=n.getAllLayers();console.log("🔍 查找國家:",e.currentCountry,"可用圖層:",o.map((e=>e.layerName)));const t=o.find((o=>o.layerName===e.currentCountry));return t?(console.log("✅ 找到國家圖層:",t.layerName),{}):(console.log("❌ 未找到國家圖層:",e.currentCountry),null)})),m=()=>{if(!r.value)return!1;const e=r.value.getBoundingClientRect();if(0===e.width||0===e.height)return console.warn("[MapTab] 容器尺寸為零，延遲初始化"),!1;try{return l=R().map(r.value,{center:t.mapView.center,zoom:t.mapView.zoom,zoomControl:!1,attributionControl:!1,dragging:!1,touchZoom:!1,doubleClickZoom:!1,scrollWheelZoom:!1,boxZoom:!1,keyboard:!1}),l.on("zoomend",g),l.on("moveend",f),l.getPane("popupPane").style.zIndex=2200,i.value=!0,o("map-ready",l),console.log("[MapTab] 地圖創建成功"),!0}catch(n){return console.error("[MapTab] 地圖創建失敗:",n),!1}},g=()=>{if(l){const e=l.getZoom(),n=l.getCenter();t.setMapView([n.lat,n.lng],e),o("update:zoomLevel",e)}},f=()=>{if(l){const e=l.getCenter();t.setMapView([e.lat,e.lng],l.getZoom()),o("update:currentCoords",{lat:e.lat,lng:e.lng})}},y=()=>{if(!l)return;s&&l.removeLayer(s);const e=t.basemaps.find((e=>e.value===t.selectedBasemap));e&&e.url&&(s=R().tileLayer(e.url,{attribution:"© OpenStreetMap contributors",maxZoom:18}),l.addLayer(s))},v=e=>{b(),e&&e._leaflet_id&&console.log("高亮要素:",e.properties.name)},b=()=>{console.log("重置圖層樣式")},h=()=>{console.log("圖層同步已禁用，使用 HTML 中心點顯示")},C=()=>{l&&setTimeout((()=>{l.invalidateSize()}),100)},w=()=>{let e=0;const o=20,n=()=>{e>=o?console.error("[MapTab] 地圖初始化失敗，已達到最大嘗試次數"):(e++,console.log(`[MapTab] 嘗試創建地圖 (${e}/${o})`),m()?(console.log("[MapTab] 地圖創建成功，開始初始化"),y(),h()):(console.log("[MapTab] 地圖創建失敗，100ms 後重試"),setTimeout(n,100)))};n()};let L=null,T=null;const x=()=>{r.value&&window.ResizeObserver&&(L=new ResizeObserver((()=>{T&&clearTimeout(T),T=setTimeout((()=>{console.log("🔄 容器大小變化，刷新地圖"),C()}),200)})),L.observe(r.value),console.log("✅ ResizeObserver 已設置"))};return(0,a.sV)((()=>{(0,a.dY)((()=>{w(),x()}))})),(0,a.hi)((()=>{T&&clearTimeout(T),L&&L.disconnect(),l&&(l.remove(),l=null),s=null,i.value=!1})),(0,a.wB)((()=>n.layers),h,{deep:!0}),(0,a.wB)((()=>t.selectedBasemap),(()=>{i.value&&y()})),{mapContainer:r,mapContainerId:c,isAnyLayerVisible:p,currentCountryInfo:d,highlightFeature:v,invalidateSize:C,defineStore:t}}};const N=(0,p.A)(E,[["render",k]]);var A=N,K={name:"HomeView",components:{MapTab:A},setup(){const e=I(),o=O(),n=o=>e.setMapInstance(o),t=o=>{const n=r.value?.find((e=>e.layerId===o));n&&(console.log("🌍 切換到國家:",n.layerName),l.value=n.layerName),e.navigateToCountry(o)},r=(0,a.EW)((()=>e.layers[0].groupLayers)),l=(0,u.KR)("TAIWAN");return(0,a.sV)((()=>{t("Taiwan")})),{setMapInstance:n,navigateToCountry:t,countries:r,defineStore:o,currentCountry:l}}};const V=(0,p.A)(K,[["render",T]]);var _=V;const B=[{path:"/",name:"Home",component:_}],S=(0,g.aE)({history:(0,g.LA)("/30DayMapChallenge-03_Polygons/"),routes:B});var P=S;n(323);console.log("🎨 樣式文件載入完成");const F=(0,t.Ef)(m),W=(0,r.Ey)();F.use(P),F.use(W),F.mount("#app"),console.log("🚀 空間分析視覺化平台已啟動"),console.log("📦 Pinia 狀態管理已初始化"),console.log("🗺️ Vue Router 路由系統已就緒"),console.log("🎨 Bootstrap 5 UI 框架已載入"),console.log("🗺️ Leaflet 地圖庫已準備就緒"),console.log("🔤 Font Awesome 圖示庫已載入")}},o={};function n(t){var r=o[t];if(void 0!==r)return r.exports;var a=o[t]={exports:{}};return e[t].call(a.exports,a,a.exports,n),a.exports}n.m=e,function(){var e=[];n.O=function(o,t,r,a){if(!t){var l=1/0;for(c=0;c<e.length;c++){t=e[c][0],r=e[c][1],a=e[c][2];for(var s=!0,i=0;i<t.length;i++)(!1&a||l>=a)&&Object.keys(n.O).every((function(e){return n.O[e](t[i])}))?t.splice(i--,1):(s=!1,a<l&&(l=a));if(s){e.splice(c--,1);var u=r();void 0!==u&&(o=u)}}return o}a=a||0;for(var c=e.length;c>0&&e[c-1][2]>a;c--)e[c]=e[c-1];e[c]=[t,r,a]}}(),function(){n.n=function(e){var o=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(o,{a:o}),o}}(),function(){n.d=function(e,o){for(var t in o)n.o(o,t)&&!n.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:o[t]})}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){n.o=function(e,o){return Object.prototype.hasOwnProperty.call(e,o)}}(),function(){var e={524:0};n.O.j=function(o){return 0===e[o]};var o=function(o,t){var r,a,l=t[0],s=t[1],i=t[2],u=0;if(l.some((function(o){return 0!==e[o]}))){for(r in s)n.o(s,r)&&(n.m[r]=s[r]);if(i)var c=i(n)}for(o&&o(t);u<l.length;u++)a=l[u],n.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return n.O(c)},t=self["webpackChunk_30DayMapChallenge_03_Polygons"]=self["webpackChunk_30DayMapChallenge_03_Polygons"]||[];t.forEach(o.bind(null,0)),t.push=o.bind(null,t.push.bind(t))}();var t=n.O(void 0,[504],(function(){return n(8500)}));t=n.O(t)})();
//# sourceMappingURL=app.c8f1b44f.js.map